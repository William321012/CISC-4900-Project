<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="http://code.jquery.com/jquery-latest.js"></script>
</head>
<body>
CART

<form action="order.html" id="form" onsubmit="return veri(this)">
<table>
    <thead>
        <tr>
            <th>checkbox</th>
            <th>image</th>
            <th>unit/price</th>
            <th>num</th>
            <th>sum</th>
            <th>operation</th>
        </tr>
    </thead>

    <tbody id="cartContent">

    </tbody>

<!--    <input type="submit" value="check out">-->
    <button  onclick="veri()">checkout</button>
</table>
</form>




<script>
    $(document).ready(function (){
        display_cart()
    })

    function display_cart(){

        $("#cartContent").empty();

        $.ajax({
            url:"/carts/display",
            type:"get",
            dataType:"json",

            success:function (json) {
                if(json.state==200) {
                    var list=json.data
                    for(var i=0; i<list.length;i++) {
                        var tr = ' <tr>\n' +
                            '            <td><input type="checkbox" value="#{id}" name="checkId"></td>\n' +
                            '            <td><image src="#{image}"></image></td>\n' +
                            '            <td>#{title}</td>\n' +
                            '            <td>$ <span id="unitPrice#{id}">#{unitPrice}</span></td>\n' +
                            '            <td><input type="button" value="-" id="minus-#{id}" onclick="reduceNum(#{id})"><input type="text" name="" id="num#{id}" size="2" value="#{num}" readonly><input type="button" value="+" id="plus+#{id}" onclick="addNum(#{id})"></td>\n' +
                            '            <td><span id="sum#{id}">#{sum}</span></td>\n' +
                            '            <td><button onclick="delete(#{id}})">delete</button></td>\n' +
                            '        </tr>'

                        tr = tr.replaceAll("#{id}", list[i].id);
                        tr = tr.replace("#{image}", list[i].image);
                        tr = tr.replace("#{title}", list[i].title);
                        tr = tr.replace("#{unitPrice}", list[i].unitPrice);
                        tr = tr.replace("#{sum}", list[i].num * list[i].unitPrice);
                        tr = tr.replace("#{num}", list[i].num);

                        $("#cartContent").append(tr)

                    }


                }else if (json.state == 8001) {
                    location.href = "index.html";
                } else {
                    alert("Failed to obtain commodity information. ProcedureÔºÅ" + json.message);
                }
            }
        })
    }

    function veri(e){
        alert("veri")
        var length = e.children.length;
        alert("length: "+length)
        for(var i=0; i<length;i++) {
            if ($("#form").children()[i].checked == true) {
                alert(1)
                return true;
            }
        }
        alert(0)
        return false;

    }

    // function veri(){
    //     alert("veri")
    //     var length=$("#form").children().length;
    //     alert(length)
    //     for(var i=0; i<length; i++){
    //         if($("#form").children()[i].checked == false){
    //             alert("check a product")
    //             return;
    //         }
    //     }
    //     $("#form").submit();
    // }

    function reduceNum(id){
        var unitPrice = $("#unitPrice"+id).html();
        alert(unitPrice)

        $.ajax({
            url:"/carts/minusNumFromTheCart",
            type:"get",
            data:"id="+id,
            dataType:"json",


            success:function (json) {
                if(json.state == 200){
                    alert("minus amount success")
                    var num=json.data
                    $("#num"+id).val(num)
                    var newSum= num*unitPrice
                    $("#sum"+id).html(newSum)
                }else{

                }
            }
        })
    }

    function addNum(id){
        var unitPrice = $("#unitPrice"+id).html();
        alert(unitPrice)

        $.ajax({
            url:"/carts/addNumFromTheCart",
            type:"get",
            data:"id="+id,
            dataType:"json",


            success:function (json) {
                if(json.state == 200){
                    alert("add amount success")
                    var num=json.data
                    $("#num"+id).val(num)
                    var newSum= num*unitPrice
                    $("#sum"+id).html(newSum)
                }else{

                }
            }
        })
    }




</script>
</body>
</html>